{% extends 'layout/base.html' %}
{% load static %}
{% block title %}Inicio{% endblock %}
{% block content %}
<div class="container mt-5">
    <div class="card shadow-sm">
        <div class="card-body">
            <h1 class="card-title text-center mb-4">Bienvenido, {{ request.user.username }}</h1>

            <p class="card-text fs-5 text-center">
                Resumen de primeras entradas del día: <span class="fw-bold">{{ usuarios_finales|length }}</span>
            </p>

            <div class="table-responsive mt-4">
                <table class="table table-bordered table-hover">
                    <thead class="table-light">
                        <tr>
                            <th>Nombre</th>
                            <th>Tipo</th>
                            <th>Hora</th>
                            <th>Estación</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% if error %}
                            <tr>
                                <td colspan="4" class="text-center text-danger">Error: {{ error }}</td>
                            </tr>
                        {% elif usuarios_finales %}
                            {% for item in usuarios_finales %}
                                {% if item.salida_ayer %}
                                    <tr>
                                        <td rowspan="2">{{ item.usuario.nombre }}</td>
                                        <td>Salida (ayer)</td>
                                        <td>{{ item.salida_ayer.timestamp_local|time:"H:i" }}</td>
                                        <td>
                                            {{ item.usuario.estacion.nombre|default:"-" }}
                                        </td>
                                    </tr>
                                    <tr>
                                        <td>Entrada</td>
                                        <td>{{ item.entrada.timestamp_local|time:"H:i" }}</td>
                                        <td>
                                            {{ item.usuario.estacion.nombre|default:"-" }}
                                        </td>
                                    </tr>
                                {% else %}
                                    <tr>
                                        <td>{{ item.usuario.nombre }}</td>
                                        <td>Entrada</td>
                                        <td>{{ item.entrada.timestamp_local|time:"H:i" }}</td>
                                        <td>
                                            {{ item.usuario.estacion.nombre|default:"-" }}
                                        </td>
                                    </tr>
                                {% endif %}
                            {% endfor %}
                        {% else %}
                            <tr>
                                <td colspan="4" class="text-center text-muted">Sin asistencias hoy.</td>
                            </tr>
                        {% endif %}
                    </tbody>
                </table>
            </div>
        </div>
    </div>
</div>
<script src="{% static 'js/frontend/components/filtro.js' %}"></script>
{% endblock %}
